<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="9p, 9p2000, research, Plan 9, Inferno, Unix, Open Source, Bell Labs" />
	<meta name="description" content="Open source distributed operating system Plan 9 from Bell Labs." />
	<link rel="stylesheet" href="/wiki-style.css" media="all" type="text/css" />
	<title>Replacing 9load (Plan 9 wiki)</title>
</head>
<body>
<h1><a name="top"></a>
Replacing 9load</h1>

<div class='body'> <!-- ***************************** -->


<pre>
Date: Mon, 5 Dec 2005 15:47:14 -0500
From: Russ Cox &lt;rsc@swtch.com&gt;
To: 9fans &lt;9fans@cse.psu.edu&gt;
Subject: [9fans] replacing 9load
</pre>

<p class='para'>
For
quite
a
few
years,
various
of
us
have
talked
about
replacing
9load.
When
Jim
and
I
replaced
b.com
with
the
combination
of
ld.com
and
9load,
we
considered
using
a
stock
Plan
9
kernel
instead.
Sean
Quinlan
took
a
few
steps
toward
making
this
possible:
he
added
the
configuration
environment
#ec,
the
Dev.shutdown
routines,
and
/dev/reboot.
With
these,
one
can
use
the
kernel
as
an
impromptu
boot
loader
already.
I
believe
Ron
Minnich
does
just
that
in
some
of
his
machines.
</p>

<p class='para'>
There
are
a
few
things
9load
does
that
the
kernel
depends
on.
The
main
one
is
loading
plan9.ini
from
somewhere
and
leaving
it
in
memory.
A
secondary
one
is
setting
up
the
APM
BIOS
interface,
and
in
the
original
VESA
code
written
for
Inferno,
9load
was
responsible
for
setting
up
the
VGA.
With
the
new
realmode
code
(or
better,
if
someone
would
write
it,
VM86
code)
in
the
kernel,
the
APM
and
VESA
can
be
done
by
the
kernel
proper.
That
leaves
plan9.ini.
</p>

<p class='para'>
Plan9.ini
serves
two
related
but
different
purposes.
The
first
is
to
give
the
kernel
hints
about
hardware
recognition.
The
second
is
to
specify
a
few
aspects
of
the
software
configuration.
Ideally,
it
would
be
nice
if
plan9.ini
could
become
optional.
</p>

<p class='para'>
Hardware
recognition
was
a
much
bigger
problem
in
the
old
ISA
days.
Plan9.ini
was,
at
the
time,
an
excellent
alternative
to
recompiling
the
kernel
to
hard-wire
all
the
constants
about
your
machine.
Now
that
we
have
PCI
and
its
device
ids,
you
don't
need
to
tell
the
kernel
what
hardware
you
have
anymore.
It
knows,
usually
better
than
you.
</p>

<p class='para'>
That
leaves
the
software
configuration:
mouse,
vga,
serial
console,
kernel
location,
root
file
system
location,
boot
menu,
etc.
The
mouse
and
vga
could
possibly
be
auto-detected,
and
the
new
vga
resize
code
(if
it
works)
makes
it
possible
to
correct
a
bad
guess
about
the
user's
desired
screen
size.
</p>

<p class='para'>
The
other
options
in
plan9.ini
--
the
serial
console,
the
kernel
and
root
file
system,
the
boot
menu
--
can't
just
be
guessed.
Jim
has
been
playing
with
loading
plan9.ini
via
PXE/TFTP,
which
is
great
for
a
real
single-file-server
Plan
9
setup,
though
it
won't
satisfy
the
single-machine
users.
I
don't
expect
this
part
of
plan9.ini
to
go
away,
though
one
could
make
9load
do
without
it
in
the
general
case
(scan
the
local
9fats
for
files
named
9pc*,
for
example).
</p>

<p class='para'>
When
I
put
the
new
mmu
code
into
the
kernels,
I
didn't
feel
like
putting
it
into
9load
too.
Instead
I
wrote
a
small
binary
that
turns
a
gzipped
kernel
into
a
9load
binary
that
the
PBS
bootstrap
could
load
into
memory.
You
run
</p>

<pre>
cat load 9pcload.gz &gt;9load
</pre>

<p class='para'>
to
produce
a
9load
from
a
kernel.
I
have
put
this
in
/n/sources/contrib/rsc/load.
</p>

<p class='para'>
This
new
program
means
that
you
can
build
yourself
a
special
pcload
kernel
with
some
9load-like
user-level
program
installed
as
/boot/boot
instead
of
the
usual
boot.
It
would
find
plan9.ini,
present
any
prompts
if
needed,
find
and
load
a
kernel,
and
then
/dev/reboot
into
it.
You
could
put
dossrv,
ext2srv,
fossil,
venti,
kfs,
factotum,
mount,
tftp,
ftpfs,
hget,
etc.,
into
the
root
file
system,
to
load
kernels
off
of
any
conceivable
medium.
</p>

<p class='para'>
While
a
new
9load
using
the
real
kernel
could
be
great,
it's
not
very
high
on
my
or
Jim's
to
do
list,
since
the
current
9load
suffices,
and
we're
more
interested
in
what
happens
once
the
kernel
is
in
memory
than
the
mundane
and
now
all-too-familiar
details
of
the
x86
boot
process.
</p>

<p class='para'>
I
encourage
those
of
you
grumbling
for
a
new
9load
to
attack
one
of
the
following
problems:
</p>

<ul>

<li>
write
vm86
code
for
the
kernel
to
replace
the
realmode
code.
vm86
code
should
be
safer
and
more
reliable
and
will
make
the
vesa
and
apm
code
run
on
more
machines.
</li>
</ul>

<ul>

<li>
write
a
mouse
auto-detector:
scan
the
usb,
try
ps2,
scan
the
serial
ports.
this
should
be
almost
trivial.
</li>
</ul>

<ul>

<li>
write
a
vga
size
auto-detector:
try
aux/vga
-m
vesa
-p
and
fetch
and
parse
the
edid
information
from
the
monitor.
aux/vga
does
most
of
this
already.
</li>
</ul>

<ul>

<li>
write
a
user-level
program
to
be
the
`9load'
in
a
9pcload
kernel.
the
program
should
have
generic
"get
me
a
plan9.ini"
and
"get
me
a
kernel"
interfaces,
like
the
current
9load,
so
that
many
boot
methods
can
be
plugged
in.
</li>
</ul>

<p class='para'>
Ironically,
once
this
is
all
done
we'll
have
moved
full
circle
to
where
Plan
9
was
many
years
ago,
when
the
hobbit
boot
loader
was
just
a
Plan
9
kernel
with
a
different
load
address
and
a
special
boot
program
that
let
you
set
environment
variables,
examine
memory,
attach
to
file
servers,
run
programs
that
were
downloaded,
and
load
and
boot
a
kernel.
</p>

<p class='para'>
Russ
</p>


</div> <!-- ***************************** -->

<hr class='banner_sep' />

<div class='banner'>
<ul>
	<li><a href="../plan_9_wiki/">Wiki</a></li>
	<li><a href="../Documentation/">Docs</a></li>
	<li><a href="../news/">News</a></li>
	<li><a href="../development/">Devel</a></li>
	<li><a href="../papers/">Papers</a></li>
	<li><a href="../download/">Download</a></li>

</ul>
</div>

<hr class='footer_sep' />

<div class='footer'>
<a href="history.html">History</a> -
<a href="diff.html">Diff</a> - 
<a href="#top">Top of this page</a> -
<span class='last_mod'>Last modified Tue Dec 20 05:52:41 EST 2005</span> 
<br />
	<div class='about_wiki'>
<a href="http://plan9.bell-labs.com/plan9"><img align="middle" src="http://plan9.bell-labs.com/plan9/img/power36.gif" alt="Powered by Plan 9" /></a>
	<a href="../about.html">About this Wiki</a>
	</div>


</div>

</body></html>
	<!-- <a href="http://plan9.bell-labs.com/plan9dist/glenda.html"><img align="middle" src="http://plan9.bell-labs.com/plan9dist/img/9logo.jpg" alt="Glenda" /></a> -->
